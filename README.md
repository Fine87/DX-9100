# DX-9100 - Работа с BIOS, подбор/получение пароля

Речь пойдёт о контроллере производства Johnson Controls DX-9100-8454 2000-х годов.

Репозиторий будет дополнятся и обновляться по мере добавления материала.
> Всё будет, но не скоро!

- [X] Описание контроллера
- [X] Среда разработки
- [X] Установка пароля
- [X] Захват пакетов данных
- [X] Анализ пакетов данных
- [X] Контрольная сумма CRC (checksumm)
- [ ] Получение пароля
- [ ] Работа с микросхемой BIOS
- [ ] Работа с микросхемой EEPROM

## Описание контроллера

DX-9100-8454 свободно программируемый.

В наличии:
- 8 аналоговых входов (AI)
- 8 аналоговых выходов (AO)
- 8 дискретных входов (DI)
- 8 дискретных выходов (DO)
- XT-bus, RS-485 (LonWorks/N2-bus), RS-232-C

Широко использовался в системах отопления, вентиляции, кондиционирования и холодоснабжения. Сейчас устарел.

## Среда разботки

Среда программирования - *GX-9100 Graphic Configuration software LIT-6364060*. Работает на операционных системах Windows XP, 7, 10 x86. Кабель для подключения к ПК - RS-232-USB.

## Установка пароля

Для включения возможности использования пароля для защиты от загрузки/выгрузки прошивки необходимо в файл ``C:\WINDOWS\GX9100.INI`` добавить строку в раздел Settings:
```
[Settings]
PasswordEnable=Yes
```
После перезапуска появится окно ввода пароля при загрузке/выгрузке прошивки.

![Password](https://github.com/Fine87/DX-9100/blob/main/img/gx_9100_passwd.jpg)

>Upload - **выгрузить** прошивку с контроллера. Download - **загрузить** прошивку в контроллер! В случае промаха - просто затирается существующая прошивка пустой :sweat_smile:

Пароль может содержать цифры (0-9), буквы латинского алфавита верхнего и нижнего регистров (A-Z, a-z). Длина пароля - 4 символа. Число комбинаций - 14776336.

## Захват пакетов данных

Для захвата можно использовать сниффер COM порта.

| Направление | Пароль верный (0012) | Пароль неверный (0100) |
|-------------|---------------|-----------------|
|От ПК в DX   | >00000        | >00000          |
|От ПК в DX   | >01800C621005 | >01800C621005   |
|От DX в ПК   | A1800B730A5   | A1800B730A5     |
|От ПК в DX   | >00000        | >00000          |
|От ПК в DX   | >0180007A0405 | >0180007A0405   |
|От DX в ПК   | A1800B730A5   | A1800B730A5     |
|От ПК в DX   | >00000        |  >00000         |
|От ПК в DX   |>01C8309F619CFBE78411| >01C8309E619EF9EA8211|
|От DX в ПК   | A             | A               |
|От ПК в DX   | >00000        | >00000          |
|От ПК в DX   | >0180037407FE | >0180037407FE   |
|От DX в ПК   | A40003F80A5   | AC000BD81C2     |
|Передача     | продолжается  | разрыв соединения |

## Анализ пакетов данных

Теперь, зная как формируются пакеты, необходимо понять в каком месте пакета находится пароль.

Структура пакета 01-C830-9F619CFB-E78411 с паролем следующая:
- 01 - адрес устройства в сети (1-255)
- С830 - из HEX в DEC C8 (200) 30 (48). Перемножить и получим 9600 бит/с скорость передачи данных
- 9F619CFB - пароль
- E78411 - контрольная сумма (CRC, checksumm)

Если пароль 0000 (X1,X2,X3,X4) в пакете выглядит как 9F609FF9 (Y1,Y2,Y3,Y4), а  0001 - 9F609EFA и тд., то выходит следующий алгоритм преобразования пароля в пакет данных (слева-направо):
```
Y1 = 159 - (X1 + X2)
Y2 = 96 + (X2 + X3) 
Y3 = 159 - (X3 + X4)
Y4 = если X4<=6, то 249 + X4. Если X4=7, то 0. Если X4>7, то X4-7
```
Для цифр понятно, а как быть с буквами? Всё просто. Каждой букве соответствует своё число, т.е.
- A = 17
- Z = 42
- a = 49
- z = 74

Для пароля 5556 - 956A94FF, для аааа (49-49-49-49) - 3DC23D2A.

## Контрольная сумма CRC (checksumm)

Этот вопрос остаётся открытым, т.к. я не смог понять как она формируется.
Возможно поможет реверсинжиниринг программы GX-9100.

## Получение пароля

